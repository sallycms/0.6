# Copyright (c) 2010, webvariants GbR, http://www.webvariants.de
#
# This file is released under the terms of the MIT license. You can find the
# complete text in the attached LICENSE file or online at:
#
# http://www.opensource.org/licenses/mit-license.php

RewriteEngine On
# RewriteBase /

# Single-Domain
# RewriteCond %{HTTP_HOST} ^example\.de$
# RewriteRule ^(.*)$ http://www.example.de/$1 [R=301,L]

# REDAXO-Rewrites (X-Y-Artikel.html)
RewriteRule ^([0-9]*)-([0-9]*)- index.php?article_id=$1&clang=$2&%{QUERY_STRING}
RewriteRule ^([0-9]*)- index.php?article_id=$1&%{QUERY_STRING}

# Image Resize Cache
# 1. get filename
# 2. get document root
#    %{DOCUMENT_ROOT} is not working on some hosters. we parse the document root out of %{REQUEST_FILENAME}
#    because the %{REQUEST_FILENAME} might not contain the filename, its given by 1.
# 3. check for file existence. both ways: with calculated document root and document root variable
# 4. rewrite!
RewriteCond %{REQUEST_URI} (.*/)?imageresize/(.*)
RewriteCond %{REQUEST_FILENAME}###%2 (.*/)imageresize.*###(.*)
RewriteCond %1/data/dyn/public/image_resize/cache__%2 -f
RewriteRule imageresize/(.*)$ data/dyn/public/image_resize/cache__$1 [L]

# Image Resize
RewriteRule ^imageresize/(.*)$ index.php?rex_resize=$1 [L]

# Deployer-AddOn (>= 2.0)
RewriteRule ^assets/js/([0-9a-f]{6})\.[0-9a-f]+\.min\.js$   gzip.php?file=data/dyn/public/deployer/compressed_$1.js&forever=1 [L]
RewriteRule ^assets/css/([0-9a-f]{6})\.[0-9a-f]+\.min\.css$ gzip.php?file=data/dyn/public/deployer/compressed_$1.css&forever=1 [L]

# Scaffold f√ºr alle Frontend-CSS-Dateien
RewriteCond %{REQUEST_FILENAME}  -f
RewriteCond %{REQUEST_URI}       \.css$
RewriteCond %{REQUEST_URI}       !wym_styles.css$
RewriteRule assets/css/(.+)$     sally/scaffold.php?f=assets/css/$1&%{QUERY_STRING} [L]

# Komprimierung fuer statischen Content
RewriteRule ^(assets/.*\.(css|js))$  gzip.php?file=$1 [L]
