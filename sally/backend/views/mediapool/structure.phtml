<?php
/*
 * Copyright (C) 2009 REDAXO
 *
 * This program is free software; you can redistribute it and/or modify it under
 * the terms of the GNU General Public License Version 2 as published by the
 * Free Software Foundation.
 */

////////////////////////////////////////////////////////
// print breadcrumb path

$base     = 'index.php?page=mediapool_structure&amp;cat_id=';
$textpath = '<li> : <a href="'.$base.'0">'.ht('start').'</a></li>';
$catID    = sly_request('cat_id', 'int');
$cat      = sly_Util_MediaCategory::findById($catID);

if ($cat === null) {
	$categories = sly_Util_MediaCategory::getRootCategories();
	$catID      = 0;
}
else {
	$categories = $cat->getChildren();
	$parents    = $cat->getParentTree();

	foreach ($parents as $parent) {
		$textpath .= '<li> : <a href="'.$base.$parent->getId().'">'.sly_html($parent->getName()).'</a></li>';
	}

	$textpath .= '<li> : <a href="'.$base.$catID.'">'.sly_html($cat->getName()).'</a></li>';
}

?>
<div class="sly-navi-path">
	<ul>
		<li><?php echo t('path') ?></li>
		<?php echo $textpath ?>
	</ul>
</div>
<?php

////////////////////////////////////////////////////////
// info and error messages

print $this->render('mediapool/notices.phtml');

////////////////////////////////////////////////////////
// start form if needed

$editID = sly_request('edit_id', 'int');

if ($this->action == 'add' || $this->action == 'edit') {
	$addMode = $this->action == 'add';

	?>
	<form action="index.php" method="post">
		<fieldset>
			<input type="hidden" name="page" value="mediapool_structure" />
			<input type="hidden" name="cat_id" value="<?php echo $catID ?>" />
			<input type="hidden" name="func" value="<?php echo $this->action ?>" />
			<?php	if ($this->action): ?>
			<input type="hidden" name="edit_id" value="<?php echo $editID ?>" />
			<?php endif ?>

			<?php foreach ($this->args as $name => $value): ?>
			<input type="hidden" name="args[<?php echo $name ?>]" value="<?php echo sly_html($value) ?>" />
			<?php endforeach ?>
		</fieldset>
		<?php
}

?>
<table class="sly-table" id="sly-mediapool-structure" summary="<?php echo sly_html(t('pool_kat_summary')) ?>">
	<caption class="rex-hide"><?php echo sly_html(t('pool_structure_caption')) ?></caption>
	<thead><tr>
		<th class="sly-icon">
			<a class="rex-i-element rex-i-mediapool-category-add sly-sprite" href="<?php echo $base.$catID ?>&amp;func=add">
				<span class="rex-i-element-text"><?php echo t('add_category') ?></span>
			</a>
		</th>
		<th class="sly-small sly-col-b">ID</th>
		<th class="name"><?php echo t('category_name') ?></th>
		<th class="sly-col-d" colspan="2"><?php echo t('function') ?></th>
	</tr></thead>
	<tbody><?php

	if ($this->action == 'add') {
		?>
		<tr class="active">
			<td class="sly-icon"><span class="rex-i-element rex-i-mediapool-category sly-sprite"><span class="rex-i-element-text"><?php echo t('add_category') ?></span></span></td>
			<td class="sly-small sly-col-b">-</td>
			<td class="name sly-has-input"><div><input class="rex-form-text" type="text" size="10" id="rex-form-field-name" name="catname" value="" autofocus="autofocus" required="required" placeholder="<?php echo ht('category_name') ?>" /></div></td>
			<td class="sly-col-d sly-has-input" colspan="2"><div><input type="submit" class="rex-form-submit" value="<?php echo t('add_category') ?>" /></div></td>
		</tr>
		<?php
	}

	foreach ($categories as $cat) {
		$id = $cat->getId();

		if ($this->action == 'edit' && $editID == $id) {
			?>
			<tr class="active">
				<td class="sly-icon"><span class="rex-i-element rex-i-mediapool-category sly-sprite"><span class="rex-i-element-text"><?php echo sly_html($cat->getName())?></span></span></td>
				<td class="sly-small sly-col-b"><?php echo $id ?></td>
				<td class="name sly-has-input"><div><input class="rex-form-text" type="text" id="rex-form-field-name" name="catname" value="<?php echo sly_html($cat->getName()) ?>" autofocus="autofocus" required="required" placeholder="<?php echo ht('category_name') ?>" /></div></td>
				<td class="sly-col-d sly-has-input" colspan="2"><div><input type="submit" class="rex-form-submit" value="<?php echo t('save_category') ?>" /></div></td>
			</tr>
			<?php
		}
		else {
			?>
			<tr>
				<td class="sly-icon"><a class="rex-i-element rex-i-mediapool-category sly-sprite" href="<?php echo $base.$id ?>"><span class="rex-i-element-text"><?php echo sly_html($cat->getName())?></span></a></td>
				<td class="sly-small"><?php echo $id ?></td>
				<td class="name"><a href="<?php echo $base.$id ?>"><?php echo sly_html($cat->getName()) ?></a></td>
				<td class="sly-col-e"><a href="<?php echo $base.$catID ?>&amp;func=edit&amp;edit_id=<?php echo $id ?>"><?php echo t('change')?></a></td>
				<td class="sly-col-f"><a href="<?php echo $base.$catID ?>&amp;func=delete&amp;edit_id=<?php echo $id ?>" class="sly-action sly-delete"><?php echo t('delete') ?></a></td>
			</tr>
			<?php
		}
	}

	if (empty($categories) && $this->action !== 'add' && $this->action !== 'edit') {
		?>
		<tr>
			<td colspan="5" class="center"><?php echo t('no_categories_yet') ?></td>
		</tr>
		<?php
	}

	?></tbody>
</table>

<?php

if ($this->action == 'add' || $this->action == 'edit') {
	print '</form>';
}
